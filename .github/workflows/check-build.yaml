name: Configure and build

on:

  push:
    branches:
      - master
      - develop

  pull_request:
    branches:
      - master
      - develop

jobs:

  style:

    name: coding style
    uses: ./.github/workflows/check-coding-style.yaml

  build:

    strategy:
      matrix:
        os: [ubuntu-latest]    #[ubuntu-latest, macos-latest]

    runs-on: ${{ matrix.os }}

    steps:

      - name: Install linux dependencies
        if: matrix.os == 'ubuntu-latest'
        run: |
          sudo apt-get update -q
          sudo apt-get install -qy gfortran gcc g++
          sudo apt-get install -qy expect
          sudo apt-get install -qy libmotif-dev

      - name: Install macOS dependencies
        if: matrix.os == 'macos-latest'
        run: |
          brew install gcc
          brew install tcl-tk
          brew install openmotif

      - name: Compiler versions
        run: |
          gfortran --version
          gcc  --version
          g++ --version
          make --version

      - name: Checkout
        uses: actions/checkout@v3

      - name: Build EGSnrc
        run: |
          HEN_HOUSE/scripts/configure.expect ${{ runner.os }}.conf | tee configure.log
          for f in HEN_HOUSE/log/*.log configure.log; do echo $f; cat $f; done
          (! grep -i fail configure.log)
