<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>EGSnrc C++ class library: sources/egs_point_source/egs_point_source.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<script language="JavaScript" type="text/javascript">
    $(document).ready(function(){
    var imgArr = new Array( // relative paths of images
    'linac2.png',
    'egs_isotropic_source.png',
    'egs_conestack.png',
    'car.png',
    'egs_cd_geometry.png',
    'chamber.png',
    'c_in_box.png',
    'egs_collimated_source.png',
    'egs_iplanes.png',
    'egs_point_source.png',
    'linac_s1.png',
    'egs_ndgeometry.png',
    'egs_roundrect_cylinders.png',
    'egs_source_collection.png',
    'egs_xyzrepeater.png',
    'cones.png',
    'egs_prism.png',
    'egs_pyramid.png',
    'I6702.png',
    'egs_xyzgeometry.png',
    'linac1.png'
    );
    var preloadArr = new Array();
    var i;
    /* preload images */
    for(i=0; i < imgArr.length; i++){
    preloadArr[i] = new Image();
    preloadArr[i].src = imgArr[i];
    }
    changeImg();
    var intID = setInterval(changeImg, 5000);
    /* image rotator */
    function changeImg(){
    $('#egsImageScroller').css('background','#000000 url(' + preloadArr[Math.floor(Math.random() * imgArr.length)].src +') center/contain no-repeat');
    }
    });
</script>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="egsImageScroller"></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EGSnrc C++ class library
   &#160;<span id="projectnumber">Report PIRS-898 (2021)</span>
   </div>
   <div id="projectbrief">Iwan Kawrakow, Ernesto Mainegra-Hing, Frederic Tessier, Reid Townson and Blake Walters</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Coding&#160;Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">sources/egs_point_source/egs_point_source.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>A point source is a special case of an <a class="el" href="classEGS__IsotropicSource.html">isotropic source </a>. Due to its simplicity, it provides a good example for discussing the implementation of a new source class.</p>
<p>The point source header file <code>egs_point_source.h</code> includes the base source header file, the header file of the <a class="el" href="classEGS__Vector.html" title="A class representing 3D vectors. ">EGS_Vector</a> class to gain access to the methods manipulating 3D vectors, and the random number generator (RNG) header file to get access to the declaration of the various RNG methods needed to sample particles  <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__base__source_8h.html">egs_base_source.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__vector_8h.html">egs_vector.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__rndm_8h.html">egs_rndm.h</a>&quot;</span></div>
</div><!-- fragment --> It then defines a macro <code>EGS_POINT_SOURCE_EXPORT</code> that will be used to mark DSO symbols as exports when building the point source DSO and as imports when linking against the DSO: <div class="fragment"><div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #ifdef BUILD_POINT_SOURCE_DLL</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_POINT_SOURCE_EXPORT __declspec(dllexport)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_POINT_SOURCE_EXPORT __declspec(dllimport)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="preprocessor">    #define EGS_POINT_SOURCE_LOCAL</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #ifdef HAVE_VISIBILITY</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_POINT_SOURCE_EXPORT __attribute__ ((visibility (&quot;default&quot;)))</span></div>
<div class="line"><span class="preprocessor">        #define EGS_POINT_SOURCE_LOCAL  __attribute__ ((visibility (&quot;hidden&quot;)))</span></div>
<div class="line"><span class="preprocessor">    #else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_POINT_SOURCE_EXPORT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_POINT_SOURCE_LOCAL</span></div>
<div class="line"><span class="preprocessor">    #endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --></p>
<p>We derive the point source class from <a class="el" href="classEGS__BaseSimpleSource.html" title="Base class for &#39;simple&#39; particle sources. ">EGS_BaseSimpleSource</a> instead of <a class="el" href="classEGS__BaseSource.html" title="Base source class. All particle sources must be derived from this class. ">EGS_BaseSource</a> because a point source is a "simple" source (<em>i.e</em> consists of a spectrum and an energy-independent probability distribution for position and direction): <div class="fragment"><div class="line"></div>
<div class="line"><span class="keyword">class </span>EGS_POINT_SOURCE_EXPORT <a name="_a0"></a><a class="code" href="classEGS__PointSource.html">EGS_PointSource</a> : <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="classEGS__BaseSimpleSource.html">EGS_BaseSimpleSource</a> {</div>
<div class="line"></div>
<div class="line">    <a name="_a2"></a><a class="code" href="classEGS__Vector.html">EGS_Vector</a> xo;      </div>
<div class="line">    <span class="keywordtype">bool</span>       valid;   </div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
</div><!-- fragment --> The private variables <code>xo</code> (point source position) and <code>valid</code> will be set in the constructors (see below). We provide two methods for constructing a point source: directly by passing a charge, a spectrum, a source position and a name to the constructor, <div class="fragment"><div class="line"></div>
<div class="line">    <a class="code" href="classEGS__PointSource.html">EGS_PointSource</a>(<span class="keywordtype">int</span> Q, <a name="_a3"></a><a class="code" href="classEGS__BaseSpectrum.html">EGS_BaseSpectrum</a> *Spec, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;Xo,</div>
<div class="line">                    <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;Name=<span class="stringliteral">&quot;&quot;</span>, <a name="_a4"></a><a class="code" href="classEGS__ObjectFactory.html">EGS_ObjectFactory</a> *f=0) :</div>
<div class="line">        <a class="code" href="classEGS__BaseSimpleSource.html">EGS_BaseSimpleSource</a>(Q,Spec,Name,f), xo(Xo), valid(true) {</div>
<div class="line">        setUp();</div>
<div class="line">    };</div>
</div><!-- fragment --> and from the information provided by an <a class="el" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> object <div class="fragment"><div class="line"></div>
<div class="line">    <a class="code" href="classEGS__PointSource.html">EGS_PointSource</a>(<a name="_a5"></a><a class="code" href="classEGS__Input.html">EGS_Input</a> *, <a class="code" href="classEGS__ObjectFactory.html">EGS_ObjectFactory</a> *f=0);</div>
</div><!-- fragment --> The implementation of the second constructor is in the .cpp file and will be discussed below.</p>
<p>The main method that must be implemented in a derived simple source class is <a class="el" href="classEGS__BaseSimpleSource.html#a4c4ce264223cf78497937fe6f3124f9b">getPositionDirection() </a> to sample the position and direction of a single particle and to set its statistical weight <div class="fragment"><div class="line">    <span class="keywordtype">void</span> getPositionDirection(<a name="_a6"></a><a class="code" href="classEGS__RandomGenerator.html">EGS_RandomGenerator</a> *rndm,</div>
<div class="line">                              <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;x, <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;u, EGS_Float &amp;wt) {</div>
</div><!-- fragment --> Sampling the particle position for a point source is easy: it is simply the point source position <div class="fragment"><div class="line">        x = xo;</div>
</div><!-- fragment --> Sampling the direction is also easy: one samples <img class="formulaInl" alt="$u_z$" src="form_132.png"/> uniformely between -1 and 1, picks a random azimuthal angle <img class="formulaInl" alt="$\phi$" src="form_133.png"/> between 0 and <img class="formulaInl" alt="$2 \pi$" src="form_134.png"/> and sets <img class="formulaInl" alt="$ u_x = \sqrt{1 - u_z^2} \cos \phi, u_y = \sqrt{1 - u_z^2} \sin \phi$" src="form_135.png"/>: <div class="fragment"><div class="line">        u.z = 2*rndm-&gt;<a name="a7"></a><a class="code" href="classEGS__RandomGenerator.html#abad39a80b392acb3ab7935db0bd94b79">getUniform</a>()-1;</div>
<div class="line">        EGS_Float sinz = 1-u.z*u.z;</div>
<div class="line">        <span class="keywordflow">if</span> (sinz &gt; <a name="a8"></a><a class="code" href="group__egspp__main.html#gac5a51c4d1a2d49ad111b65c848f45719">epsilon</a>) {</div>
<div class="line">            sinz = sqrt(sinz);</div>
<div class="line">            EGS_Float cphi, sphi;</div>
<div class="line">            rndm-&gt;<a name="a9"></a><a class="code" href="classEGS__RandomGenerator.html#a1a8125374996eec60b8e017aca93c047">getAzimuth</a>(cphi,sphi);</div>
<div class="line">            u.x = sinz*cphi;</div>
<div class="line">            u.y = sinz*sphi;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
</div><!-- fragment --> The statistical weight of the particle is always unity <div class="fragment"><div class="line">            u.x = 0;</div>
<div class="line">            u.y = 0;</div>
<div class="line">        }</div>
<div class="line">        wt = 1;</div>
<div class="line">    };</div>
</div><!-- fragment --></p>
<p>The next function to implement is <code>getFluence</code>(), which should return the particle "fluence" emitted so far by the source. We arbitrarily decide to define the "fluence" of our point source to be the number of particles emitted by the source (we also could have picked the number of particles per unit solid angle or real fluence at a certain distance from the source) and therefore the <code>getFluence</code>() implementation is very easy: <div class="fragment"><div class="line"></div>
<div class="line">    EGS_Float getFluence()<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keywordflow">return</span> count;</div>
<div class="line">    };</div>
</div><!-- fragment --> Here, <code>count</code> is a protected data member inhereted from <a class="el" href="classEGS__BaseSimpleSource.html" title="Base class for &#39;simple&#39; particle sources. ">EGS_BaseSimpleSource</a>, which is initialized to zero in the simple source constructor and is incremented by one in each invocation of the <a class="el" href="classEGS__BaseSimpleSource.html#aff8f779daa8394fe1692890bfb8650b9">getNextParticle() </a> function.</p>
<p>The next task is to implement the functions that store the state of a point source object to a data stream and restore the state from a data stream. This is needed for the ability to restart simulations. Because our source class is very simple, no data needs to be stored/restored in addition to the data already stored/restored by <a class="el" href="classEGS__BaseSource.html" title="Base source class. All particle sources must be derived from this class. ">EGS_BaseSource</a> and <a class="el" href="classEGS__BaseSimpleSource.html" title="Base class for &#39;simple&#39; particle sources. ">EGS_BaseSimpleSource</a>. The implementation of these functions is therefore extremely simple: <div class="fragment"><div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> storeFluenceState(ostream &amp;)<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> setFluenceState(istream &amp;) {</div>
</div><!-- fragment --></p>
<p>The next step in the header file is to provide a <code>isValid</code> function, which should return <code>true</code>, if the source object is valid and <code>false</code> otherwise (<em>e.g</em>. it does not have a spectrum). <code>isValid</code>() is needed so that the <code>createSource</code>() function that must be provided by the source DSO (see below) can be implemented by simply using the template <a class="el" href="egs__base__source_8h.html#a35031a174feed11a403176165432c754" title="A template source creation function. ">createSourceTemplate()</a>: <div class="fragment"><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> isValid()<span class="keyword"> const </span>{</div>
</div><!-- fragment --></p>
<p>The final step in the point source declaration is to specify a protected function that will be used to set up the source type and description <div class="fragment"><div class="line">        <span class="keywordflow">return</span> (valid &amp;&amp; s != 0);</div>
<div class="line">    };</div>
</div><!-- fragment --></p>
<p>The <code>egs_point_source.cpp</code> file provides implementation of the constructor that creates a point source object from information stored in an <a class="el" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> object, the <code>setUp</code>() function and the C-style source creation function <code>createSource</code>() that must be provided by each source DSO. It includes the point source header file and the input object header file  <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__point__source_8h.html">egs_point_source.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__input_8h.html">egs_input.h</a>&quot;</span></div>
</div><!-- fragment --></p>
<p>The point source constructor calls the <a class="el" href="classEGS__BaseSimpleSource.html#aa3cdfd40f1596eb0a6369159868ef670">base simple source </a> constructor passing the input as argument <div class="fragment"><div class="line"></div>
<div class="line"><a name="a10"></a><a class="code" href="classEGS__PointSource.html#ae5085c6a044295c5f8477bb281c24e0d">EGS_PointSource::EGS_PointSource</a>(<a class="code" href="classEGS__Input.html">EGS_Input</a> *input, <a class="code" href="classEGS__ObjectFactory.html">EGS_ObjectFactory</a> *f) :</div>
<div class="line">    <a class="code" href="classEGS__BaseSimpleSource.html">EGS_BaseSimpleSource</a>(input,f), xo(), valid(true) {</div>
</div><!-- fragment --> This sets the name of the source from the <code>name</code> key, sets the charge from a <code>charge</code> key and constructs the spectrum from the information in a <code>spectrum</code> composite property using <a class="el" href="classEGS__BaseSpectrum.html#aaf11ec2f02be812666f474537c00940e" title="Create and return a pointer to a spectrum object from the information pointed to by inp...">EGS_BaseSpectrum::createSpectrum()</a>. The only task remaining for a complete point source definition is to determine the position of the source: <div class="fragment"><div class="line">    vector&lt;EGS_Float&gt; pos;</div>
<div class="line">    <span class="keywordtype">int</span> err = input-&gt;<a name="a11"></a><a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719">getInput</a>(<span class="stringliteral">&quot;position&quot;</span>,pos);</div>
</div><!-- fragment --> The position was successfully set if <code>err=0</code> and the number of inputs to the <code>position</code> key is exactly 3 (defining a 3D position), otherwise a warning is issued and the source is set to be invalid: <div class="fragment"><div class="line">    <span class="keywordflow">if</span> (!err &amp;&amp; pos.size() == 3) {</div>
<div class="line">        xo = <a class="code" href="classEGS__Vector.html">EGS_Vector</a>(pos[0],pos[1],pos[2]);</div>
<div class="line">    }</div>
</div><!-- fragment --> The source type and description is then set using <code>setUp</code>(). <div class="fragment"><div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        <a name="a12"></a><a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb">egsWarning</a>(<span class="stringliteral">&quot;EGS_PointSource: missing/wrong &#39;position&#39; input\n&quot;</span>);</div>
<div class="line">        valid = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
</div><!-- fragment --></p>
<p>The implementation of the <code>setUp</code> function sets the type string to "EGS_PointSource" and the description string to a short sentence constructed from the charge and spectrum type: <div class="fragment"><div class="line">    setUp();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a name="a13"></a><a class="code" href="classEGS__PointSource.html#a4c779e9d1bc98b18821bb44fe92a2eba">EGS_PointSource::setUp</a>() {</div>
<div class="line">    <a name="a14"></a><a class="code" href="classEGS__Object.html#a84f3f4988afbd9ea3eea30659d617d40">otype</a> = <span class="stringliteral">&quot;EGS_PointSource&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (!isValid()) {</div>
<div class="line">        <a name="a15"></a><a class="code" href="classEGS__BaseSource.html#a8cd077c4dc46018211a8be539b33493c">description</a> = <span class="stringliteral">&quot;Invalid point source&quot;</span>;</div>
<div class="line">    }</div>
</div><!-- fragment --></p>
<p>The <code>createSource</code> C-style function implementation simply uses the <a class="el" href="egs__base__source_8h.html#a35031a174feed11a403176165432c754" title="A template source creation function. ">createSourceTemplate()</a> function: <div class="fragment"><div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        description = <span class="stringliteral">&quot;Point source with &quot;</span>;</div>
<div class="line">        description += s-&gt;getType();</div>
<div class="line">        <span class="keywordflow">if</span> (q == -1) {</div>
<div class="line">            description += <span class="stringliteral">&quot;, electrons&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q == 0) {</div>
<div class="line">            description += <span class="stringliteral">&quot;, photons&quot;</span>;</div>
<div class="line">        }</div>
</div><!-- fragment --> The conditions for being able to use <a class="el" href="egs__base__source_8h.html#a35031a174feed11a403176165432c754" title="A template source creation function. ">createSourceTemplate()</a> to construct a source are</p>
<ul>
<li>The source provides a constructor that takes pointers to an <a class="el" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> object and an object factory as arguments</li>
<li>The source provides a <code>isValid</code>() function returning a boolean value.</li>
</ul>
<p>This completes the implementation of our point source class.</p>
<p>The Makefile is very similar to the Makefile of a geometry DSO (see <em>e.g</em>. <a href="geometry_2example2_2geometry__example2_8cpp-example.html">this example</a>): we include the egspp config setting for the make system,  <div class="fragment"><div class="line">include $(EGS_CONFIG)</div>
<div class="line">include $(SPEC_DIR)egspp.spec</div>
<div class="line">include $(SPEC_DIR)egspp_$(my_machine).conf</div>
</div><!-- fragment --> set the pre-processor defines to include the <code>BUILD_POINT_SOURCE_DLL</code> macro, <div class="fragment"><div class="line"></div>
<div class="line">DEFS = $(DEF1) -DBUILD_POINT_SOURCE_DLL</div>
</div><!-- fragment --> define the DSO name and files needed to build the DSO, <div class="fragment"><div class="line"></div>
<div class="line">library = egs_point_source</div>
<div class="line">lib_files = egs_point_source</div>
</div><!-- fragment --> set the dependences to be set of header files common for all sources, <div class="fragment"><div class="line">my_deps = $(common_source_deps)</div>
<div class="line">extra_dep = $(addprefix $(DSOLIBS), $(my_deps))</div>
</div><!-- fragment --> include the rules for building a DSO, <div class="fragment"><div class="line"></div>
<div class="line">include $(SPEC_DIR)egspp_libs.spec</div>
</div><!-- fragment --> and make the dependences take effect <div class="fragment"><div class="line"></div>
<div class="line">$(make_depend)</div>
</div><!-- fragment --></p>
<p>We can now build our point source DSO by typing <code>make</code> and use it for simulations by including input such as </p>
<pre class="fragment">:start source:
    library = egs_points_source
    name = some_name
    charge = -1
    :start spectrum:
       definition of a spectrum
    :stop spectrum:
    position = 15 -3 7
:stop source:
</pre><p> in the source definition section of the input file.</p>
<p>This is the complete Makefile: </p>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">###############################################################################</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  EGSnrc egs++ makefile to build point source</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  Copyright (C) 2015 National Research Council Canada</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  This file is part of EGSnrc.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  EGSnrc is free software: you can redistribute it and/or modify it under</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  the terms of the GNU Affero General Public License as published by the</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  Free Software Foundation, either version 3 of the License, or (at your</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  option) any later version.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  more details.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  You should have received a copy of the GNU Affero General Public License</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">###############################################################################</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  Author:          Iwan Kawrakow, 2005</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  Contributors:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">###############################################################################</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line">include $(EGS_CONFIG)</div>
<div class="line">include $(SPEC_DIR)egspp.spec</div>
<div class="line">include $(SPEC_DIR)egspp_$(my_machine).conf</div>
<div class="line"></div>
<div class="line">DEFS = $(DEF1) -DBUILD_POINT_SOURCE_DLL</div>
<div class="line"></div>
<div class="line">library = egs_point_source</div>
<div class="line">lib_files = egs_point_source</div>
<div class="line">my_deps = $(common_source_deps)</div>
<div class="line">extra_dep = $(addprefix $(DSOLIBS), $(my_deps))</div>
<div class="line"></div>
<div class="line">include $(SPEC_DIR)egspp_libs.spec</div>
<div class="line"></div>
<div class="line">$(make_depend)</div>
</div><!-- fragment --><p> This is the complete header file: </p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc egs++ point source headers</span></div>
<div class="line"><span class="comment">#  Copyright (C) 2015 National Research Council Canada</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  This file is part of EGSnrc.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is free software: you can redistribute it and/or modify it under</span></div>
<div class="line"><span class="comment">#  the terms of the GNU Affero General Public License as published by the</span></div>
<div class="line"><span class="comment">#  Free Software Foundation, either version 3 of the License, or (at your</span></div>
<div class="line"><span class="comment">#  option) any later version.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span></div>
<div class="line"><span class="comment">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div>
<div class="line"><span class="comment">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span></div>
<div class="line"><span class="comment">#  more details.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  You should have received a copy of the GNU Affero General Public License</span></div>
<div class="line"><span class="comment">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Author:          Iwan Kawrakow, 2005</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Contributors:    Frederic Tessier</span></div>
<div class="line"><span class="comment">#                   Reid Townson</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef EGS_POINT_SOURCE_</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define EGS_POINT_SOURCE_</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__base__source_8h.html">egs_base_source.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__vector_8h.html">egs_vector.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__rndm_8h.html">egs_rndm.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #ifdef BUILD_POINT_SOURCE_DLL</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_POINT_SOURCE_EXPORT __declspec(dllexport)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_POINT_SOURCE_EXPORT __declspec(dllimport)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define EGS_POINT_SOURCE_LOCAL</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #ifdef HAVE_VISIBILITY</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_POINT_SOURCE_EXPORT __attribute__ ((visibility (&quot;default&quot;)))</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_POINT_SOURCE_LOCAL  __attribute__ ((visibility (&quot;hidden&quot;)))</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_POINT_SOURCE_EXPORT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_POINT_SOURCE_LOCAL</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">class </span>EGS_POINT_SOURCE_EXPORT <a class="code" href="classEGS__PointSource.html">EGS_PointSource</a> : <span class="keyword">public</span> <a class="code" href="classEGS__BaseSimpleSource.html">EGS_BaseSimpleSource</a> {</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classEGS__Vector.html">EGS_Vector</a> xo;      </div>
<div class="line">    <span class="keywordtype">bool</span>       valid;   </div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classEGS__PointSource.html">EGS_PointSource</a>(<span class="keywordtype">int</span> Q, <a class="code" href="classEGS__BaseSpectrum.html">EGS_BaseSpectrum</a> *Spec, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;Xo,</div>
<div class="line">                    <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;Name=<span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classEGS__ObjectFactory.html">EGS_ObjectFactory</a> *f=0) :</div>
<div class="line">        <a name="a16"></a><a class="code" href="classEGS__BaseSimpleSource.html#a0bba051b0ee4d8a5a4e9f08ee1db196a">EGS_BaseSimpleSource</a>(Q,Spec,Name,f), xo(Xo), valid(<span class="keyword">true</span>) {</div>
<div class="line">        setUp();</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classEGS__PointSource.html">EGS_PointSource</a>(<a class="code" href="classEGS__Input.html">EGS_Input</a> *, <a class="code" href="classEGS__ObjectFactory.html">EGS_ObjectFactory</a> *f=0);</div>
<div class="line">    ~<a class="code" href="classEGS__PointSource.html">EGS_PointSource</a>() {};</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> <a name="a17"></a><a class="code" href="classEGS__BaseSimpleSource.html#a4c4ce264223cf78497937fe6f3124f9b">getPositionDirection</a>(<a class="code" href="classEGS__RandomGenerator.html">EGS_RandomGenerator</a> *rndm,</div>
<div class="line">                              <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;x, <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;u, EGS_Float &amp;wt) {</div>
<div class="line">        x = xo;</div>
<div class="line">        u.<a name="a18"></a><a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> = 2*rndm-&gt;<a class="code" href="classEGS__RandomGenerator.html#abad39a80b392acb3ab7935db0bd94b79">getUniform</a>()-1;</div>
<div class="line">        EGS_Float sinz = 1-u.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a>*u.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (sinz &gt; <a class="code" href="group__egspp__main.html#gac5a51c4d1a2d49ad111b65c848f45719">epsilon</a>) {</div>
<div class="line">            sinz = sqrt(sinz);</div>
<div class="line">            EGS_Float cphi, sphi;</div>
<div class="line">            rndm-&gt;<a class="code" href="classEGS__RandomGenerator.html#a1a8125374996eec60b8e017aca93c047">getAzimuth</a>(cphi,sphi);</div>
<div class="line">            u.<a name="a19"></a><a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> = sinz*cphi;</div>
<div class="line">            u.<a name="a20"></a><a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> = sinz*sphi;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            u.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> = 0;</div>
<div class="line">            u.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> = 0;</div>
<div class="line">        }</div>
<div class="line">        wt = 1;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    EGS_Float <a name="a21"></a><a class="code" href="classEGS__BaseSource.html#a7cc529dacf022256477ba3bf7da33aa2">getFluence</a>()<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <a name="a22"></a><a class="code" href="classEGS__BaseSimpleSource.html#aeb6f47fe1590b54f1be46b081767ee59">count</a>;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a23"></a><a class="code" href="classEGS__BaseSimpleSource.html#a40470def37451ee0d0f91d1c99f4a7af">storeFluenceState</a>(ostream &amp;)<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a24"></a><a class="code" href="classEGS__BaseSimpleSource.html#adb12d459777f5580e15410ba5027f9fd">setFluenceState</a>(istream &amp;) {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a25"></a><a class="code" href="classEGS__BaseSimpleSource.html#ad99228597d9e9f4de5ce1251ad69f2d5">isValid</a>()<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keywordflow">return</span> (valid &amp;&amp; s != 0);</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> setUp();</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p> This is the complete source file:</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc egs++ point source</span></div>
<div class="line"><span class="comment">#  Copyright (C) 2015 National Research Council Canada</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  This file is part of EGSnrc.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is free software: you can redistribute it and/or modify it under</span></div>
<div class="line"><span class="comment">#  the terms of the GNU Affero General Public License as published by the</span></div>
<div class="line"><span class="comment">#  Free Software Foundation, either version 3 of the License, or (at your</span></div>
<div class="line"><span class="comment">#  option) any later version.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span></div>
<div class="line"><span class="comment">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div>
<div class="line"><span class="comment">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span></div>
<div class="line"><span class="comment">#  more details.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  You should have received a copy of the GNU Affero General Public License</span></div>
<div class="line"><span class="comment">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Author:          Iwan Kawrakow, 2005</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Contributors:</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__point__source_8h.html">egs_point_source.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__input_8h.html">egs_input.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="classEGS__PointSource.html#ae5085c6a044295c5f8477bb281c24e0d">EGS_PointSource::EGS_PointSource</a>(<a class="code" href="classEGS__Input.html">EGS_Input</a> *input, <a class="code" href="classEGS__ObjectFactory.html">EGS_ObjectFactory</a> *f) :</div>
<div class="line">    <a class="code" href="classEGS__BaseSimpleSource.html">EGS_BaseSimpleSource</a>(input,f), xo(), valid(true) {</div>
<div class="line">    vector&lt;EGS_Float&gt; pos;</div>
<div class="line">    <span class="keywordtype">int</span> err = input-&gt;<a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719">getInput</a>(<span class="stringliteral">&quot;position&quot;</span>,pos);</div>
<div class="line">    <span class="keywordflow">if</span> (!err &amp;&amp; pos.size() == 3) {</div>
<div class="line">        xo = <a class="code" href="classEGS__Vector.html">EGS_Vector</a>(pos[0],pos[1],pos[2]);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb">egsWarning</a>(<span class="stringliteral">&quot;EGS_PointSource: missing/wrong &#39;position&#39; input\n&quot;</span>);</div>
<div class="line">        valid = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    setUp();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classEGS__PointSource.html#a4c779e9d1bc98b18821bb44fe92a2eba">EGS_PointSource::setUp</a>() {</div>
<div class="line">    <a class="code" href="classEGS__Object.html#a84f3f4988afbd9ea3eea30659d617d40">otype</a> = <span class="stringliteral">&quot;EGS_PointSource&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (!isValid()) {</div>
<div class="line">        <a class="code" href="classEGS__BaseSource.html#a8cd077c4dc46018211a8be539b33493c">description</a> = <span class="stringliteral">&quot;Invalid point source&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code" href="classEGS__BaseSource.html#a8cd077c4dc46018211a8be539b33493c">description</a> = <span class="stringliteral">&quot;Point source with &quot;</span>;</div>
<div class="line">        <a class="code" href="classEGS__BaseSource.html#a8cd077c4dc46018211a8be539b33493c">description</a> += <a name="a26"></a><a class="code" href="classEGS__BaseSimpleSource.html#a4d725d182dc703dc2014dd630552374b">s</a>-&gt;<a name="a27"></a><a class="code" href="classEGS__BaseSpectrum.html#a2d68ed2cfac62d9036a7499f58be72df">getType</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a28"></a><a class="code" href="classEGS__BaseSimpleSource.html#a1fa7d4b4114238f4d2d152125f0ca47c">q</a> == -1) {</div>
<div class="line">            <a class="code" href="classEGS__BaseSource.html#a8cd077c4dc46018211a8be539b33493c">description</a> += <span class="stringliteral">&quot;, electrons&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classEGS__BaseSimpleSource.html#a1fa7d4b4114238f4d2d152125f0ca47c">q</a> == 0) {</div>
<div class="line">            <a class="code" href="classEGS__BaseSource.html#a8cd077c4dc46018211a8be539b33493c">description</a> += <span class="stringliteral">&quot;, photons&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classEGS__BaseSimpleSource.html#a1fa7d4b4114238f4d2d152125f0ca47c">q</a> == 1) {</div>
<div class="line">            <a class="code" href="classEGS__BaseSource.html#a8cd077c4dc46018211a8be539b33493c">description</a> += <span class="stringliteral">&quot;, positrons&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code" href="classEGS__BaseSource.html#a8cd077c4dc46018211a8be539b33493c">description</a> += <span class="stringliteral">&quot;, unknown particle type&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div>
<div class="line"></div>
<div class="line">    EGS_POINT_SOURCE_EXPORT <a name="_a29"></a><a class="code" href="classEGS__BaseSource.html">EGS_BaseSource</a> *createSource(<a class="code" href="classEGS__Input.html">EGS_Input</a> *input,</div>
<div class="line">            <a class="code" href="classEGS__ObjectFactory.html">EGS_ObjectFactory</a> *f) {</div>
<div class="line">        <span class="keywordflow">return</span> createSourceTemplate&lt;EGS_PointSource&gt;(input,f,<span class="stringliteral">&quot;point source&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
