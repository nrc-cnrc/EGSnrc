<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>EGSnrc C++ class library: geometry/egs_box/egs_box.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<script language="JavaScript" type="text/javascript">
    $(document).ready(function(){
    var imgArr = new Array( // relative paths of images
    'linac2.png',
    'egs_isotropic_source.png',
    'egs_conestack.png',
    'car.png',
    'egs_cd_geometry.png',
    'chamber.png',
    'c_in_box.png',
    'egs_collimated_source.png',
    'egs_iplanes.png',
    'egs_point_source.png',
    'linac_s1.png',
    'egs_ndgeometry.png',
    'egs_roundrect_cylinders.png',
    'egs_source_collection.png',
    'egs_xyzrepeater.png',
    'cones.png',
    'egs_prism.png',
    'egs_pyramid.png',
    'I6702.png',
    'egs_xyzgeometry.png',
    'linac1.png'
    );
    var preloadArr = new Array();
    var i;
    /* preload images */
    for(i=0; i < imgArr.length; i++){
    preloadArr[i] = new Image();
    preloadArr[i].src = imgArr[i];
    }
    changeImg();
    var intID = setInterval(changeImg, 5000);
    /* image rotator */
    function changeImg(){
    $('#egsImageScroller').css('background','#000000 url(' + preloadArr[Math.floor(Math.random() * imgArr.length)].src +') center/contain no-repeat');
    }
    });
</script>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="egsImageScroller"></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EGSnrc C++ class library
   &#160;<span id="projectnumber">Report PIRS-898 (2021)</span>
   </div>
   <div id="projectbrief">Iwan Kawrakow, Ernesto Mainegra-Hing, Frederic Tessier, Reid Townson and Blake Walters</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Coding&#160;Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">geometry/egs_box/egs_box.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>The following describes the implementation of a box geometry that can serve as a guide to users for developing their own geometry classes.</p>
<p>Our box geometry class will describe a parallelepiped of a user defined size that defines a single region filled with 1 medium.</p>
<p>As our geometry must be derived from <a class="el" href="classEGS__BaseGeometry.html" title="Base geometry class. Every geometry class must be derived from EGS_BaseGeometry. ">EGS_BaseGeometry</a>, we include its header file. We also want to be able to transform the box from being centered about the origin and having its faces parallel to the x-, y- and z-axis to any other location and/or orientation. For that we will employ <a class="el" href="classEGS__AffineTransform.html">affine transformations </a> and therefore also include the transformations header file: <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__base__geometry_8h.html">egs_base_geometry.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__transformations_8h.html">egs_transformations.h</a>&quot;</span></div>
</div><!-- fragment --> As with other geometries, we will be compiling our box class into a shared library. We have to therefore mark the symbols that will be exported from the library. For this purpose we define a macro <code>EGS_BOX_EXPORT</code>, which we define like this <div class="fragment"><div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #ifdef BUILD_BOX_DLL</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_BOX_EXPORT __declspec(dllexport)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_BOX_EXPORT __declspec(dllimport)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="preprocessor">    #define EGS_BOX_LOCAL</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #ifdef HAVE_VISIBILITY</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_BOX_EXPORT __attribute__ ((visibility (&quot;default&quot;)))</span></div>
<div class="line"><span class="preprocessor">        #define EGS_BOX_LOCAL  __attribute__ ((visibility (&quot;hidden&quot;)))</span></div>
<div class="line"><span class="preprocessor">    #else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_BOX_EXPORT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_BOX_LOCAL</span></div>
<div class="line"><span class="preprocessor">    #endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --> We are now ready to develop our box geometry class by deriving from <a class="el" href="classEGS__BaseGeometry.html" title="Base geometry class. Every geometry class must be derived from EGS_BaseGeometry. ">EGS_BaseGeometry</a>: <div class="fragment"><div class="line"></div>
<div class="line"><span class="keyword">class </span>EGS_BOX_EXPORT <a name="_a0"></a><a class="code" href="classEGS__Box.html">EGS_Box</a> : <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a> {</div>
<div class="line"></div>
<div class="line">    EGS_Float           ax, ay, az;</div>
<div class="line">    <a name="_a2"></a><a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a> *T;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">string</span>       type;</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
</div><!-- fragment --> The data members <code>ax,ay,az</code> are for the box size, the <code>type</code> static data member will be set to "EGS_Box" and used and the <code>T</code> data member will point to the affine transformation associated with boxes not located about the origin and/or rotated boxes. We now need a constructor and a destructor for box objects. We provide two different constructors: one for boxes where all sides have the same size (<em>i.e</em>. cubes) <div class="fragment"><div class="line"></div>
<div class="line">    <a class="code" href="classEGS__Box.html">EGS_Box</a>(EGS_Float a, <span class="keyword">const</span> <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a> *t = 0,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;Name = <span class="stringliteral">&quot;&quot;</span>) : <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a>(Name),</div>
<div class="line">        ax(a), ay(a), az(a), T(0)  {</div>
<div class="line">        <span class="keywordflow">if</span> (t) {</div>
<div class="line">            T = <span class="keyword">new</span> <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a>(*t);</div>
<div class="line">        }</div>
<div class="line">        nreg = 1;</div>
<div class="line">    };</div>
</div><!-- fragment --> and one for boxes with 3 different sides <div class="fragment"><div class="line"></div>
<div class="line">    <a class="code" href="classEGS__Box.html">EGS_Box</a>(EGS_Float Ax, EGS_Float Ay, EGS_Float Az,</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a> *t = 0,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;Name = <span class="stringliteral">&quot;&quot;</span>) : <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a>(Name),</div>
<div class="line">        ax(Ax), ay(Ay), az(Az), T(0)  {</div>
<div class="line">        <span class="keywordflow">if</span> (t) {</div>
<div class="line">            T = <span class="keyword">new</span> <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a>(*t);</div>
<div class="line">        }</div>
<div class="line">        nreg = 1;</div>
<div class="line">    };</div>
</div><!-- fragment --> In the destructor we simply deallocate the memory used by the affine transformation, if there was a transformation defined: <div class="fragment"><div class="line"></div>
<div class="line">    ~<a class="code" href="classEGS__Box.html">EGS_Box</a>() {</div>
<div class="line">        <span class="keywordflow">if</span> (T) {</div>
<div class="line">            <span class="keyword">delete</span> T;</div>
<div class="line">        }</div>
<div class="line">    };</div>
</div><!-- fragment --> We can now start implementing the required geometry methods <a class="el" href="classEGS__BaseGeometry.html#a816bf2d26bdabc3e4ee2f092bd903d92">isInside() </a>, <a class="el" href="classEGS__BaseGeometry.html#af1a37ed6f281a2442a7e96d9658894a9">isWhere() </a>, <a class="el" href="classEGS__BaseGeometry.html#a42a459b557011291ea2e8978ebee6295">howfar() </a> and <a class="el" href="classEGS__BaseGeometry.html#a111e6d8ea34e403bebaf3621223950d9">hownear() </a>.</p>
<p>A point is inside a box about the origin if its x-position is between <code>-ax/2</code> and <code>ax/2</code>, its y-position between <code>-ay/2</code> and <code>ay/2</code>, etc. For a transformed box, the easiest way to determine if the position is inside the box is to apply the inverse transformation to the position and to then use the simple method for boxes about the origin. The <code>isInside</code> implementation therefore looks like this <div class="fragment"><div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> isInside(<span class="keyword">const</span> <a name="_a3"></a><a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;x) {</div>
<div class="line">        <a class="code" href="classEGS__Vector.html">EGS_Vector</a> xp = T ? x*(*T) : x;</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.<a name="a4"></a><a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> + ax &lt; 0 || 2*xp.x - ax &gt; 0) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.<a name="a5"></a><a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> + ay &lt; 0 || 2*xp.y - ay &gt; 0) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.<a name="a6"></a><a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> + az &lt; 0 || 2*xp.z - az &gt; 0) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    };</div>
</div><!-- fragment --> (multiplying the position vector with <code>*T</code> from the right is an operation equivalent to transforming <code>x</code> with the inverse of <code>*T</code>)</p>
<p>The implementation of the <code>isWhere</code> method is very easy: as we have a single region this function should return 0 if the position is inside and -1 if it is outside: <div class="fragment"><div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> isWhere(<span class="keyword">const</span> <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;x) {</div>
<div class="line">        <span class="keywordflow">return</span> isInside(x) ? 0 : -1;</div>
<div class="line">    };</div>
</div><!-- fragment --></p>
<p>The implementation of the <code>howfar</code> method is also easiest if we first transform the position and direction to a frame where the box is centered about the origin and its sides are parallel to the axis: <div class="fragment"></div><!-- fragment --> The <code>howfar</code> logic is different for positions inside (<em>i.e</em>. <code>ireg=0</code> ) and outside. For inside points, we must calculate the distances to the x-planes, y-planes and z-planes from the transformed point <code>xp</code> along the transformed direction <code>up</code> and take the minimum <code>t1</code> of the three. If <code>t1</code> is less than the intended step <code>t</code>, we must set <code>t</code> to <code>t1</code> and return -1 (<em>i.e</em>. the particle will exit the box at the end of the step). If <code>normal</code> is not <code>null</code>, our <code>howfar</code> function is being called from the visualization utility and we must also calculate the normal of the plane being intersected to exit the box with the normal pointing towards the position of the particle. The implementation therefore looks like this <div class="fragment"></div><!-- fragment --> When the position is outside, the logic is</p>
<ol type="1">
<li>if the particle intersects the top or bottom side, check if the intersection point is between the left-right and east-west sides.</li>
<li>If yes, this is the position where the trajectory is entering the box =&gt; return the required information</li>
<li>If no, repeat 1-2 for left-right sides and if necessary for the east-west sides.</li>
<li>If all of the above fails, the particle does not enter the box.</li>
</ol>
<p>The code is lengthy and not reproduced here.</p>
<p>The next step is the implementation of the <code>hownear</code> function. As with the other methods, we first inverse transform the position and then calculate the minimum distance to a box about the origin <div class="fragment"></div><!-- fragment --> If the position is inside the boxe (<em>i.e</em>. <code>ireg=0</code>), the minimum distance to a boundary is the minimum distance to any of the 6 faces: <div class="fragment"></div><!-- fragment --> If the position is outside, the algorithm is slightly more difficult and is left to the reader to understand from the implementation: <div class="fragment"></div><!-- fragment --></p>
<p>We reimplement the <code>getType</code> function to return <code>type</code> so that the type of our geometry class is known: <div class="fragment"></div><!-- fragment --></p>
<p>We also reimplement the <a class="el" href="classEGS__BaseGeometry.html#a90b349e45353ab0b7fa32053a9d37085">printInfo() </a> function so that users of our geometry class can get a better description of the geometry object: <div class="fragment"></div><!-- fragment --> The actual implementation of <code>printInfo</code> is in the <a class="el" href="egs__box_8cpp.html" title="A box geometry: implementation. ">egs_box.cpp</a> file, which includes <code><a class="el" href="egs__box_8h.html" title="A box geometry: header. ">egs_box.h</a></code> and <code><a class="el" href="egs__input_8h.html" title="EGS_Input class header file. ">egs_input.h</a>:</code>  <div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc egs++ box geometry</span></div>
<div class="line"><span class="comment">#  Copyright (C) 2015 National Research Council Canada</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  This file is part of EGSnrc.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is free software: you can redistribute it and/or modify it under</span></div>
<div class="line"><span class="comment">#  the terms of the GNU Affero General Public License as published by the</span></div>
<div class="line"><span class="comment">#  Free Software Foundation, either version 3 of the License, or (at your</span></div>
<div class="line"><span class="comment">#  option) any later version.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span></div>
<div class="line"><span class="comment">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div>
<div class="line"><span class="comment">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span></div>
<div class="line"><span class="comment">#  more details.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  You should have received a copy of the GNU Affero General Public License</span></div>
<div class="line"><span class="comment">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Author:          Iwan Kawrakow, 2005</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Contributors:    Frederic Tessier</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__box_8h.html">egs_box.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__input_8h.html">egs_input.h</a>&quot;</span></div>
</div><!-- fragment --> The latter is necessary to gain access to the definition of the <a class="el" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> class that is needed in the <code>createGeometry</code> function (see below). The <code>printInfo</code> implementation is simple: <div class="fragment"><div class="line"><span class="keywordtype">void</span> EGS_Box::printInfo()<span class="keyword"> const </span>{</div>
<div class="line">    <a name="a7"></a><a class="code" href="classEGS__BaseGeometry.html#a90b349e45353ab0b7fa32053a9d37085">EGS_BaseGeometry::printInfo</a>();</div>
<div class="line">    <a name="a8"></a><a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2">egsInformation</a>(<span class="stringliteral">&quot; box size = %g %g %g\n&quot;</span>,ax,ay,az);</div>
<div class="line">    <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2">egsInformation</a>(<span class="stringliteral">&quot;=======================================================\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p>We also need to declare the static data member <code>type</code> <div class="fragment"><div class="line"></div>
<div class="line"><span class="keywordtype">string</span> EGS_Box::type(<span class="stringliteral">&quot;EGS_Box&quot;</span>);</div>
</div><!-- fragment --> According to verious sources, compilers can produce better code if text strings are static and local to the library. Hence, we define the various error messages and the key we will be using to define the size of a box object as such: <div class="fragment"><div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message1[] = <span class="stringliteral">&quot;createGeometry(box): %s\n&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message2[] = <span class="stringliteral">&quot;null input?&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message3[] = <span class="stringliteral">&quot;wrong/missing &#39;box size&#39; input?&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message4[] =</div>
<div class="line">    <span class="stringliteral">&quot;expecting 1 or 3 float inputs for &#39;box size&#39;&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_key1[] = <span class="stringliteral">&quot;box size&quot;</span>;</div>
</div><!-- fragment --></p>
<p>The remaining task now is to provide a C-style function named <code>createGeometry</code> for the box shared library that will be used to dynamically create box objects based on the information stored in an <a class="el" href="classEGS__Input.html" title="A class for storing information in a tree-like structure of key-value pairs. This class is used throu...">EGS_Input</a> object. <div class="fragment"><div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div>
<div class="line"></div>
<div class="line">    EGS_BOX_EXPORT <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a> *<a name="a9"></a><a class="code" href="egs__glib_8cpp.html#af739645bb95fe92562fec40be47ee9e2">createGeometry</a>(<a name="_a10"></a><a class="code" href="classEGS__Input.html">EGS_Input</a> *input) {</div>
</div><!-- fragment --> Just to be sure, we check that <code>input</code> is not <code>null</code> and issue a warning and return <code>null</code> if it is: <div class="fragment"><div class="line">        <span class="keywordflow">if</span> (!input) {</div>
<div class="line">            <a name="a11"></a><a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb">egsWarning</a>(ebox_message1,ebox_message2);</div>
</div><!-- fragment --> We then check if the input object contains a <code>box size</code> property <div class="fragment"><div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        vector&lt;EGS_Float&gt; s;</div>
<div class="line">        <span class="keywordtype">int</span> err = input-&gt;<a name="a12"></a><a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719">getInput</a>(ebox_key1,s);</div>
</div><!-- fragment --> and if it doesn't (indicated by <code>err</code> not being zero), issue a warning and return <code>null:</code> <div class="fragment"><div class="line">        <span class="keywordflow">if</span> (err) {</div>
<div class="line">            <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb">egsWarning</a>(ebox_message1,ebox_message3);</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
</div><!-- fragment --> Next we check if the input contains a definition if a transformation for our box geometry: <div class="fragment"><div class="line">        <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a> *t = <a name="a13"></a><a class="code" href="classEGS__AffineTransform.html#a601a07115aecff1925956a9097e69950">EGS_AffineTransform::getTransformation</a>(input);</div>
</div><!-- fragment --> Depending on whether there was one or three values to the <code>box size</code> key, we use the corresponding constructor to create the new box object, but refuse to create it if there was some other number of values (because, <em>e.g</em>., the user made a mistake in the input file): <div class="fragment"><div class="line">        <a class="code" href="classEGS__Box.html">EGS_Box</a> *result;</div>
<div class="line">        <span class="keywordflow">if</span> (s.size() == 1) {</div>
<div class="line">            result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html">EGS_Box</a>(s[0],t);</div>
<div class="line">        }</div>
</div><!-- fragment --> We must now delete the affine transformation pointed to by <code>t</code> as the box object has made its own copy in the constructor <div class="fragment"><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s.size() == 3) {</div>
<div class="line">            result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html">EGS_Box</a>(s[0],s[1],s[2],t);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb">egsWarning</a>(ebox_message1,ebox_message4);</div>
<div class="line">            <span class="keywordflow">if</span> (t) {</div>
<div class="line">                <span class="keyword">delete</span> t;</div>
</div><!-- fragment --> We then use the <code>setName</code> and <code>setMedia</code> functions inherited from <a class="el" href="classEGS__BaseGeometry.html" title="Base geometry class. Every geometry class must be derived from EGS_BaseGeometry. ">EGS_BaseGeometry</a> to set the name of the newly created box and fill it with a medium <div class="fragment"><div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (t) {</div>
<div class="line">            <span class="keyword">delete</span> t;</div>
<div class="line">        }</div>
<div class="line">        result-&gt;<a name="a14"></a><a class="code" href="classEGS__BaseGeometry.html#a77e25cd36d6d94f26338cca9bc98b97d">setName</a>(input);</div>
</div><!-- fragment --> to then return the box <div class="fragment"><div class="line">        result-&gt;<a name="a15"></a><a class="code" href="classEGS__BaseGeometry.html#ae77c2c0762b6ab11b98dc9983b144299">setBoundaryTolerance</a>(input);</div>
<div class="line">        result-&gt;<a name="a16"></a><a class="code" href="classEGS__BaseGeometry.html#a28bf612777de14f97108021ae7eb3865">setMedia</a>(input);</div>
<div class="line">        result-&gt;<a name="a17"></a><a class="code" href="classEGS__BaseGeometry.html#abc5fa5c48edfbbd913e1939299fe5286">setLabels</a>(input);</div>
<div class="line">        <span class="keywordflow">return</span> result;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p>Based on this <code>createGeometry</code> implementation, users will be able to use our box geometry class by having the following input in the input file </p>
<pre class="fragment">:start geometry:
    name = some_name
    box size = 3.5 1 7
    :start transformation:
        input defining the transformation
    :stop transformation
    :start media input:
        media = H2O
    :stop media input
:stop geometry:
</pre><p> The transformation related input can be of course missing in which case the box will be centered about the origin and has its faces parallel to the x-, y- and z-axis.</p>
<p>If we would have been nice to the users of our box geometry class, we could have provided an easier way for defining the medium of the box by re-implementing the <a class="el" href="classEGS__BaseGeometry.html#a28bf612777de14f97108021ae7eb3865">setMedia() </a> function, <em>e.g</em>. something along these lines: </p>
<pre class="fragment">void EGS_Box::setMedia(EGS_Input *inp) {
    string medname; int err = inp-&gt;getInput("medium",medname);
    if( !err ) setMedium(medname);
}
</pre><p> That way, the user could define the medium of the box by simply using </p>
<pre class="fragment">medium = H2O
</pre><p> instead of <code>:start media input: ... :stop media input:</code> which is necessary for geometries with several regions and potentialy different media and therefore provided as default implementation.</p>
<p>The final step is to provide a Makefile for our geometry DSO.  We include the config files containing various definitions for the make system: <div class="fragment"><div class="line">include $(EGS_CONFIG)</div>
<div class="line">include $(SPEC_DIR)egspp.spec</div>
<div class="line">include $(SPEC_DIR)egspp_$(my_machine).conf</div>
</div><!-- fragment --> We then must add the <code>BUILD_BOX_DLL</code> macro to the list of defined macros, <div class="fragment"><div class="line"></div>
<div class="line">DEFS = $(DEF1) -DBUILD_BOX_DLL</div>
</div><!-- fragment --> set the name of the DSO, <div class="fragment"><div class="line"></div>
<div class="line">library = egs_box</div>
</div><!-- fragment --> define the source files needed to create the DSO, <div class="fragment"><div class="line">lib_files = egs_box</div>
</div><!-- fragment --> and tell the make system that our class depends on the <a class="el" href="egs__transformations_8h.html" title="EGS_AffineTransform and EGS_RotationMatrix class header file. ">egs_transformations.h</a> header file, <div class="fragment"><div class="line">my_deps = egs_transformations.h</div>
<div class="line">extra_dep = $(addprefix $(DSOLIBS), $(my_deps))</div>
</div><!-- fragment --> We can then use the generic rules for building the DSO: <div class="fragment"><div class="line"></div>
<div class="line">include $(SPEC_DIR)egspp_libs.spec</div>
</div><!-- fragment --> and because our only object file needed to build the library depends on <code>egs_box.cpp</code> and <code>egs_box.h</code>, we can also use the generic dependence rule <div class="fragment"><div class="line"></div>
<div class="line">$(make_depend)</div>
</div><!-- fragment --> That's all.</p>
<p>Here is the complete source code of the <a class="el" href="classEGS__Box.html" title="A box geometry. ">EGS_Box</a> class.<br/>
 The header file: </p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc egs++ box geometry headers</span></div>
<div class="line"><span class="comment">#  Copyright (C) 2015 National Research Council Canada</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  This file is part of EGSnrc.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is free software: you can redistribute it and/or modify it under</span></div>
<div class="line"><span class="comment">#  the terms of the GNU Affero General Public License as published by the</span></div>
<div class="line"><span class="comment">#  Free Software Foundation, either version 3 of the License, or (at your</span></div>
<div class="line"><span class="comment">#  option) any later version.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span></div>
<div class="line"><span class="comment">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div>
<div class="line"><span class="comment">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span></div>
<div class="line"><span class="comment">#  more details.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  You should have received a copy of the GNU Affero General Public License</span></div>
<div class="line"><span class="comment">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Author:          Iwan Kawrakow, 2005</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Contributors:    Reid Townson</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef EGS_BOX_</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define EGS_BOX_</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__base__geometry_8h.html">egs_base_geometry.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__transformations_8h.html">egs_transformations.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #ifdef BUILD_BOX_DLL</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_BOX_EXPORT __declspec(dllexport)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_BOX_EXPORT __declspec(dllimport)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define EGS_BOX_LOCAL</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #ifdef HAVE_VISIBILITY</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_BOX_EXPORT __attribute__ ((visibility (&quot;default&quot;)))</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_BOX_LOCAL  __attribute__ ((visibility (&quot;hidden&quot;)))</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_BOX_EXPORT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #define EGS_BOX_LOCAL</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">class </span>EGS_BOX_EXPORT <a class="code" href="classEGS__Box.html">EGS_Box</a> : <span class="keyword">public</span> <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a> {</div>
<div class="line"></div>
<div class="line">    EGS_Float           ax, ay, az;</div>
<div class="line">    <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a> *T;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">string</span>       type;</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classEGS__Box.html">EGS_Box</a>(EGS_Float a, <span class="keyword">const</span> <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a> *t = 0,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;Name = <span class="stringliteral">&quot;&quot;</span>) : <a name="a18"></a><a class="code" href="classEGS__BaseGeometry.html#ae3035a8e9f808e89340c65e8d2b6930f">EGS_BaseGeometry</a>(Name),</div>
<div class="line">        ax(a), ay(a), az(a), T(0)  {</div>
<div class="line">        <span class="keywordflow">if</span> (t) {</div>
<div class="line">            T = <span class="keyword">new</span> <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a>(*t);</div>
<div class="line">        }</div>
<div class="line">        nreg = 1;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classEGS__Box.html">EGS_Box</a>(EGS_Float Ax, EGS_Float Ay, EGS_Float Az,</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a> *t = 0,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;Name = <span class="stringliteral">&quot;&quot;</span>) : <a class="code" href="classEGS__BaseGeometry.html#ae3035a8e9f808e89340c65e8d2b6930f">EGS_BaseGeometry</a>(Name),</div>
<div class="line">        ax(Ax), ay(Ay), az(Az), T(0)  {</div>
<div class="line">        <span class="keywordflow">if</span> (t) {</div>
<div class="line">            T = <span class="keyword">new</span> <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a>(*t);</div>
<div class="line">        }</div>
<div class="line">        nreg = 1;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    ~<a class="code" href="classEGS__Box.html">EGS_Box</a>() {</div>
<div class="line">        <span class="keywordflow">if</span> (T) {</div>
<div class="line">            <span class="keyword">delete</span> T;</div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> <a name="a19"></a><a class="code" href="classEGS__BaseGeometry.html#a816bf2d26bdabc3e4ee2f092bd903d92">isInside</a>(<span class="keyword">const</span> <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;x) {</div>
<div class="line">        <a class="code" href="classEGS__Vector.html">EGS_Vector</a> xp = T ? x*(*T) : x;</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> + ax &lt; 0 || 2*xp.x - ax &gt; 0) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> + ay &lt; 0 || 2*xp.y - ay &gt; 0) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> + az &lt; 0 || 2*xp.z - az &gt; 0) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> <a name="a20"></a><a class="code" href="classEGS__BaseGeometry.html#af1a37ed6f281a2442a7e96d9658894a9">isWhere</a>(<span class="keyword">const</span> <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;x) {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="classEGS__BaseGeometry.html#a816bf2d26bdabc3e4ee2f092bd903d92">isInside</a>(x) ? 0 : -1;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> <a name="a21"></a><a class="code" href="classEGS__BaseGeometry.html#a15008e08ea330694841fc94b64a7e8d5">inside</a>(<span class="keyword">const</span> <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;x) {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="classEGS__BaseGeometry.html#af1a37ed6f281a2442a7e96d9658894a9">isWhere</a>(x);</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    EGS_Float <a name="a22"></a><a class="code" href="classEGS__BaseGeometry.html#a217bc8dd7706a988acaf97165edb6435">howfarToOutside</a>(<span class="keywordtype">int</span> ireg, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;x,</div>
<div class="line">                              <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;u) {</div>
<div class="line">        EGS_Float t = <a name="a23"></a><a class="code" href="group__egspp__main.html#gae614a4601981185563b20666902e2bba">veryFar</a>;</div>
<div class="line">        <a name="a24"></a><a class="code" href="classEGS__BaseGeometry.html#a42a459b557011291ea2e8978ebee6295">howfar</a>(ireg,x,u,t);</div>
<div class="line">        <span class="keywordflow">return</span> t;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> <a class="code" href="classEGS__BaseGeometry.html#a42a459b557011291ea2e8978ebee6295">howfar</a>(<span class="keywordtype">int</span> ireg, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;x, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;u,</div>
<div class="line">               EGS_Float &amp;t, <span class="keywordtype">int</span> *newmed=0, <a class="code" href="classEGS__Vector.html">EGS_Vector</a> *normal=0) {</div>
<div class="line">        <a class="code" href="classEGS__Vector.html">EGS_Vector</a> xp(x), up(u);</div>
<div class="line">        <span class="keywordflow">if</span> (T) {</div>
<div class="line">            xp = x*(*T);</div>
<div class="line">            up = u*T-&gt;getRotation();</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (ireg == 0) {</div>
<div class="line">            EGS_Float t1 = <a class="code" href="group__egspp__main.html#gae614a4601981185563b20666902e2bba">veryFar</a>;</div>
<div class="line">            <span class="keywordtype">int</span> inew = 0;</div>
<div class="line">            <a class="code" href="classEGS__Vector.html">EGS_Vector</a> n;</div>
<div class="line">            <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> &gt; 0) {</div>
<div class="line">                t1 = (ax - 2*xp.x)/(2*up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a>);</div>
<div class="line">                n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> = -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> &lt; 0) {</div>
<div class="line">                t1 = -(ax + 2*xp.x)/(2*up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a>);</div>
<div class="line">                n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> = 1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (t1 &lt; t) {</div>
<div class="line">                t = t1;</div>
<div class="line">                inew = -1;</div>
<div class="line">            }</div>
<div class="line">            t1 = <a class="code" href="group__egspp__main.html#gae614a4601981185563b20666902e2bba">veryFar</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> &gt; 0) {</div>
<div class="line">                t1 = (ay - 2*xp.y)/(2*up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> &lt; 0) {</div>
<div class="line">                t1 = -(ay + 2*xp.y)/(2*up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (t1 &lt; t) {</div>
<div class="line">                n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> = 0;</div>
<div class="line">                n.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> = up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> &gt; 0 ? -1 : 1;</div>
<div class="line">                t = t1;</div>
<div class="line">                inew = -1;</div>
<div class="line">            }</div>
<div class="line">            t1 = <a class="code" href="group__egspp__main.html#gae614a4601981185563b20666902e2bba">veryFar</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> &gt; 0) {</div>
<div class="line">                t1 = (az - 2*xp.z)/(2*up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> &lt; 0) {</div>
<div class="line">                t1 = -(az + 2*xp.z)/(2*up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (t1 &lt; t) {</div>
<div class="line">                t = t1;</div>
<div class="line">                inew = -1;</div>
<div class="line">                n.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> = n.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> = 0;</div>
<div class="line">                n.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> = up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> &gt; 0 ? -1 : 1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (inew &lt; 0) {</div>
<div class="line">                <span class="keywordflow">if</span> (newmed) {</div>
<div class="line">                    *newmed = -1;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (normal) {</div>
<div class="line">                    <span class="keywordflow">if</span> (T) {</div>
<div class="line">                        *normal = T-&gt;getRotation()*n;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> {</div>
<div class="line">                        *normal = n;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> inew;</div>
<div class="line">        }</div>
<div class="line">        EGS_Float t1 = <a class="code" href="group__egspp__main.html#gae614a4601981185563b20666902e2bba">veryFar</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.x + ax &lt; 0 &amp;&amp; up.x &gt; 0) {</div>
<div class="line">            t1 = -(2*xp.x + ax)/(2*up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (2*xp.x - ax &gt; 0 &amp;&amp; up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> &lt; 0) {</div>
<div class="line">            t1 = -(2*xp.x - ax)/(2*up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (t1 &lt; t) {</div>
<div class="line">            EGS_Float y1 = xp.y + up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a>*t1, z1 = xp.z + up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a>*t1;</div>
<div class="line">            <span class="keywordflow">if</span> (2*y1 + ay &gt; 0 &amp;&amp; 2*y1 - ay &lt; 0 &amp;&amp;</div>
<div class="line">                    2*z1 + az &gt; 0 &amp;&amp; 2*z1 - az &lt; 0) {</div>
<div class="line">                t = t1;</div>
<div class="line">                <span class="keywordflow">if</span> (newmed) {</div>
<div class="line">                    *newmed = <a name="a25"></a><a class="code" href="classEGS__BaseGeometry.html#a9e25deca845a02cb0b7fae1eb06c00d9">med</a>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (normal) {</div>
<div class="line">                    <span class="keywordflow">if</span> (T) {</div>
<div class="line">                        <span class="keyword">const</span> <a name="_a26"></a><a class="code" href="classEGS__RotationMatrix.html">EGS_RotationMatrix</a> &amp;R = T-&gt;getRotation();</div>
<div class="line">                        <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> &gt; 0) {</div>
<div class="line">                            *normal = R*<a class="code" href="classEGS__Vector.html">EGS_Vector</a>(-1,0,0);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">else</span> {</div>
<div class="line">                            *normal = R*<a class="code" href="classEGS__Vector.html">EGS_Vector</a>(1,0,0);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> &gt; 0) {</div>
<div class="line">                            *normal = <a class="code" href="classEGS__Vector.html">EGS_Vector</a>(-1,0,0);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">else</span> {</div>
<div class="line">                            *normal = <a class="code" href="classEGS__Vector.html">EGS_Vector</a>(1,0,0);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        t1 = <a class="code" href="group__egspp__main.html#gae614a4601981185563b20666902e2bba">veryFar</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.y + ay &lt; 0 &amp;&amp; up.y &gt; 0) {</div>
<div class="line">            t1 = -(2*xp.y + ay)/(2*up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (2*xp.y - ay &gt; 0 &amp;&amp; up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> &lt; 0) {</div>
<div class="line">            t1 = -(2*xp.y - ay)/(2*up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (t1 &lt; t) {</div>
<div class="line">            EGS_Float x1 = xp.x + up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a>*t1, z1 = xp.z + up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a>*t1;</div>
<div class="line">            <span class="keywordflow">if</span> (2*x1 + ax &gt; 0 &amp;&amp; 2*x1 - ax &lt; 0 &amp;&amp;</div>
<div class="line">                    2*z1 + az &gt; 0 &amp;&amp; 2*z1 - az &lt; 0) {</div>
<div class="line">                t = t1;</div>
<div class="line">                <span class="keywordflow">if</span> (newmed) {</div>
<div class="line">                    *newmed = <a class="code" href="classEGS__BaseGeometry.html#a9e25deca845a02cb0b7fae1eb06c00d9">med</a>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (normal) {</div>
<div class="line">                    <span class="keywordflow">if</span> (T) {</div>
<div class="line">                        <span class="keyword">const</span> <a class="code" href="classEGS__RotationMatrix.html">EGS_RotationMatrix</a> &amp;R = T-&gt;getRotation();</div>
<div class="line">                        <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> &gt; 0) {</div>
<div class="line">                            *normal = R*<a class="code" href="classEGS__Vector.html">EGS_Vector</a>(0,-1,0);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">else</span> {</div>
<div class="line">                            *normal = R*<a class="code" href="classEGS__Vector.html">EGS_Vector</a>(0,1,0);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> &gt; 0) {</div>
<div class="line">                            *normal = <a class="code" href="classEGS__Vector.html">EGS_Vector</a>(0,-1,0);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">else</span> {</div>
<div class="line">                            *normal = <a class="code" href="classEGS__Vector.html">EGS_Vector</a>(0,1,0);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        t1 = <a class="code" href="group__egspp__main.html#gae614a4601981185563b20666902e2bba">veryFar</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.z + az &lt; 0 &amp;&amp; up.z &gt; 0) {</div>
<div class="line">            t1 = -(2*xp.z + az)/(2*up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (2*xp.z - az &gt; 0 &amp;&amp; up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> &lt; 0) {</div>
<div class="line">            t1 = -(2*xp.z - az)/(2*up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (t1 &lt; t) {</div>
<div class="line">            EGS_Float x1 = xp.x + up.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a>*t1, y1 = xp.y + up.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a>*t1;</div>
<div class="line">            <span class="keywordflow">if</span> (2*x1 + ax &gt; 0 &amp;&amp; 2*x1 - ax &lt; 0 &amp;&amp;</div>
<div class="line">                    2*y1 + ay &gt; 0 &amp;&amp; 2*y1 - ay &lt; 0) {</div>
<div class="line">                t = t1;</div>
<div class="line">                <span class="keywordflow">if</span> (newmed) {</div>
<div class="line">                    *newmed = <a class="code" href="classEGS__BaseGeometry.html#a9e25deca845a02cb0b7fae1eb06c00d9">med</a>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (normal) {</div>
<div class="line">                    <span class="keywordflow">if</span> (T) {</div>
<div class="line">                        <span class="keyword">const</span> <a class="code" href="classEGS__RotationMatrix.html">EGS_RotationMatrix</a> &amp;R = T-&gt;getRotation();</div>
<div class="line">                        <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> &gt; 0) {</div>
<div class="line">                            *normal = R*<a class="code" href="classEGS__Vector.html">EGS_Vector</a>(0,0,-1);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">else</span> {</div>
<div class="line">                            *normal = R*<a class="code" href="classEGS__Vector.html">EGS_Vector</a>(0,0,1);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="keywordflow">if</span> (up.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> &gt; 0) {</div>
<div class="line">                            *normal = <a class="code" href="classEGS__Vector.html">EGS_Vector</a>(0,0,-1);</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">else</span> {</div>
<div class="line">                            *normal = <a class="code" href="classEGS__Vector.html">EGS_Vector</a>(0,0,1);</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    EGS_Float <a name="a27"></a><a class="code" href="classEGS__BaseGeometry.html#a111e6d8ea34e403bebaf3621223950d9">hownear</a>(<span class="keywordtype">int</span> ireg, <span class="keyword">const</span> <a class="code" href="classEGS__Vector.html">EGS_Vector</a> &amp;x) {</div>
<div class="line">        <a class="code" href="classEGS__Vector.html">EGS_Vector</a> xp = T ? x*(*T) : x;</div>
<div class="line">        <span class="keywordflow">if</span> (ireg &gt;= 0) {</div>
<div class="line">            EGS_Float tmin;</div>
<div class="line">            EGS_Float t1 = xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> + 0.5*ax, t2 = 0.5*ax - xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (t1 &lt; t2) {</div>
<div class="line">                tmin = t1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> {</div>
<div class="line">                tmin = t2;</div>
<div class="line">            }</div>
<div class="line">            t1 = xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> + 0.5*ay;</div>
<div class="line">            <span class="keywordflow">if</span> (t1 &lt; tmin) {</div>
<div class="line">                tmin = t1;</div>
<div class="line">            }</div>
<div class="line">            t1 = 0.5*ay - xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (t1 &lt; tmin) {</div>
<div class="line">                tmin = t1;</div>
<div class="line">            }</div>
<div class="line">            t1 = xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> + 0.5*az;</div>
<div class="line">            <span class="keywordflow">if</span> (t1 &lt; tmin) {</div>
<div class="line">                tmin = t1;</div>
<div class="line">            }</div>
<div class="line">            t1 = 0.5*az - xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (t1 &lt; tmin) {</div>
<div class="line">                tmin = t1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> tmin;</div>
<div class="line">        }</div>
<div class="line">        EGS_Float s1=0, s2=0;</div>
<div class="line">        <span class="keywordtype">int</span> nout = 0;</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> + ax &lt; 0) {</div>
<div class="line">            EGS_Float t = -0.5*ax - xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a>;</div>
<div class="line">            s1 += t;</div>
<div class="line">            s2 += t*t;</div>
<div class="line">            nout++;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (2*xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> - ax &gt; 0) {</div>
<div class="line">            EGS_Float t = xp.<a class="code" href="classEGS__Vector.html#aa67c962f9024c44d15f446c122d25cbf">x</a> - 0.5*ax;</div>
<div class="line">            s1 += t;</div>
<div class="line">            s2 += t*t;</div>
<div class="line">            nout++;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> + ay &lt; 0) {</div>
<div class="line">            EGS_Float t = -0.5*ay - xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a>;</div>
<div class="line">            s1 += t;</div>
<div class="line">            s2 += t*t;</div>
<div class="line">            nout++;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (2*xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> - ay &gt; 0) {</div>
<div class="line">            EGS_Float t = xp.<a class="code" href="classEGS__Vector.html#a156335a0c0cee0f4c6f6e23aac316350">y</a> - 0.5*ay;</div>
<div class="line">            s1 += t;</div>
<div class="line">            s2 += t*t;</div>
<div class="line">            nout++;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> + az &lt; 0) {</div>
<div class="line">            EGS_Float t = -0.5*az - xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a>;</div>
<div class="line">            s1 += t;</div>
<div class="line">            s2 += t*t;</div>
<div class="line">            nout++;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (2*xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> - az &gt; 0) {</div>
<div class="line">            EGS_Float t = xp.<a class="code" href="classEGS__Vector.html#a4d45f2e6f756337d6b06b006e04bfc87">z</a> - 0.5*az;</div>
<div class="line">            s1 += t;</div>
<div class="line">            s2 += t*t;</div>
<div class="line">            nout++;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (nout &lt; 2) {</div>
<div class="line">            <span class="keywordflow">return</span> s1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> sqrt(s2);</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;<a name="a28"></a><a class="code" href="classEGS__BaseGeometry.html#a2df5b0631c3bd57250a6a57cad56323c">getType</a>()<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keywordflow">return</span> type;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="classEGS__BaseGeometry.html#a90b349e45353ab0b7fa32053a9d37085">printInfo</a>() <span class="keyword">const</span>;</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p> The .cpp file: </p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc egs++ box geometry</span></div>
<div class="line"><span class="comment">#  Copyright (C) 2015 National Research Council Canada</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  This file is part of EGSnrc.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is free software: you can redistribute it and/or modify it under</span></div>
<div class="line"><span class="comment">#  the terms of the GNU Affero General Public License as published by the</span></div>
<div class="line"><span class="comment">#  Free Software Foundation, either version 3 of the License, or (at your</span></div>
<div class="line"><span class="comment">#  option) any later version.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span></div>
<div class="line"><span class="comment">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div>
<div class="line"><span class="comment">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span></div>
<div class="line"><span class="comment">#  more details.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  You should have received a copy of the GNU Affero General Public License</span></div>
<div class="line"><span class="comment">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Author:          Iwan Kawrakow, 2005</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Contributors:    Frederic Tessier</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__box_8h.html">egs_box.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__input_8h.html">egs_input.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> EGS_Box::printInfo()<span class="keyword"> const </span>{</div>
<div class="line">    <a class="code" href="classEGS__BaseGeometry.html#a90b349e45353ab0b7fa32053a9d37085">EGS_BaseGeometry::printInfo</a>();</div>
<div class="line">    <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2">egsInformation</a>(<span class="stringliteral">&quot; box size = %g %g %g\n&quot;</span>,ax,ay,az);</div>
<div class="line">    <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2">egsInformation</a>(<span class="stringliteral">&quot;=======================================================\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">string</span> EGS_Box::type(<span class="stringliteral">&quot;EGS_Box&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message1[] = <span class="stringliteral">&quot;createGeometry(box): %s\n&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message2[] = <span class="stringliteral">&quot;null input?&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message3[] = <span class="stringliteral">&quot;wrong/missing &#39;box size&#39; input?&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message4[] =</div>
<div class="line">    <span class="stringliteral">&quot;expecting 1 or 3 float inputs for &#39;box size&#39;&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_key1[] = <span class="stringliteral">&quot;box size&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div>
<div class="line"></div>
<div class="line">    EGS_BOX_EXPORT <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a> *<a class="code" href="egs__glib_8cpp.html#af739645bb95fe92562fec40be47ee9e2">createGeometry</a>(<a class="code" href="classEGS__Input.html">EGS_Input</a> *input) {</div>
<div class="line">        <span class="keywordflow">if</span> (!input) {</div>
<div class="line">            <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb">egsWarning</a>(ebox_message1,ebox_message2);</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        vector&lt;EGS_Float&gt; s;</div>
<div class="line">        <span class="keywordtype">int</span> err = input-&gt;<a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719">getInput</a>(ebox_key1,s);</div>
<div class="line">        <span class="keywordflow">if</span> (err) {</div>
<div class="line">            <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb">egsWarning</a>(ebox_message1,ebox_message3);</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a> *t = <a class="code" href="classEGS__AffineTransform.html#a601a07115aecff1925956a9097e69950">EGS_AffineTransform::getTransformation</a>(input);</div>
<div class="line">        <a class="code" href="classEGS__Box.html">EGS_Box</a> *result;</div>
<div class="line">        <span class="keywordflow">if</span> (s.size() == 1) {</div>
<div class="line">            result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html">EGS_Box</a>(s[0],t);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s.size() == 3) {</div>
<div class="line">            result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html">EGS_Box</a>(s[0],s[1],s[2],t);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb">egsWarning</a>(ebox_message1,ebox_message4);</div>
<div class="line">            <span class="keywordflow">if</span> (t) {</div>
<div class="line">                <span class="keyword">delete</span> t;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (t) {</div>
<div class="line">            <span class="keyword">delete</span> t;</div>
<div class="line">        }</div>
<div class="line">        result-&gt;<a class="code" href="classEGS__BaseGeometry.html#a77e25cd36d6d94f26338cca9bc98b97d">setName</a>(input);</div>
<div class="line">        result-&gt;<a class="code" href="classEGS__BaseGeometry.html#ae77c2c0762b6ab11b98dc9983b144299">setBoundaryTolerance</a>(input);</div>
<div class="line">        result-&gt;<a class="code" href="classEGS__BaseGeometry.html#a28bf612777de14f97108021ae7eb3865">setMedia</a>(input);</div>
<div class="line">        result-&gt;<a class="code" href="classEGS__BaseGeometry.html#abc5fa5c48edfbbd913e1939299fe5286">setLabels</a>(input);</div>
<div class="line">        <span class="keywordflow">return</span> result;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p> The Makefile: </p>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">###############################################################################</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  EGSnrc egs++ makefile to build box geometry</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  Copyright (C) 2015 National Research Council Canada</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  This file is part of EGSnrc.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  EGSnrc is free software: you can redistribute it and/or modify it under</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  the terms of the GNU Affero General Public License as published by the</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  Free Software Foundation, either version 3 of the License, or (at your</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  option) any later version.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  more details.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  You should have received a copy of the GNU Affero General Public License</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">###############################################################################</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  Author:          Iwan Kawrakow, 2005</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#  Contributors:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">###############################################################################</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line">include $(EGS_CONFIG)</div>
<div class="line">include $(SPEC_DIR)egspp.spec</div>
<div class="line">include $(SPEC_DIR)egspp_$(my_machine).conf</div>
<div class="line"></div>
<div class="line">DEFS = $(DEF1) -DBUILD_BOX_DLL</div>
<div class="line"></div>
<div class="line">library = egs_box</div>
<div class="line">lib_files = egs_box</div>
<div class="line">my_deps = egs_transformations.h</div>
<div class="line">extra_dep = $(addprefix $(DSOLIBS), $(my_deps))</div>
<div class="line"></div>
<div class="line">include $(SPEC_DIR)egspp_libs.spec</div>
<div class="line"></div>
<div class="line">$(make_depend)</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc egs++ box geometry</span></div>
<div class="line"><span class="comment">#  Copyright (C) 2015 National Research Council Canada</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  This file is part of EGSnrc.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is free software: you can redistribute it and/or modify it under</span></div>
<div class="line"><span class="comment">#  the terms of the GNU Affero General Public License as published by the</span></div>
<div class="line"><span class="comment">#  Free Software Foundation, either version 3 of the License, or (at your</span></div>
<div class="line"><span class="comment">#  option) any later version.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  EGSnrc is distributed in the hope that it will be useful, but WITHOUT ANY</span></div>
<div class="line"><span class="comment">#  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span></div>
<div class="line"><span class="comment">#  FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for</span></div>
<div class="line"><span class="comment">#  more details.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  You should have received a copy of the GNU Affero General Public License</span></div>
<div class="line"><span class="comment">#  along with EGSnrc. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Author:          Iwan Kawrakow, 2005</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">#  Contributors:    Frederic Tessier</span></div>
<div class="line"><span class="comment">#</span></div>
<div class="line"><span class="comment">###############################################################################</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__box_8h.html">egs_box.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="egs__input_8h.html">egs_input.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> EGS_Box::printInfo()<span class="keyword"> const </span>{</div>
<div class="line">    <a class="code" href="classEGS__BaseGeometry.html#a90b349e45353ab0b7fa32053a9d37085">EGS_BaseGeometry::printInfo</a>();</div>
<div class="line">    <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2">egsInformation</a>(<span class="stringliteral">&quot; box size = %g %g %g\n&quot;</span>,ax,ay,az);</div>
<div class="line">    <a class="code" href="group__egspp__main.html#ga38c38ac950788399c630481c2b3722f2">egsInformation</a>(<span class="stringliteral">&quot;=======================================================\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">string</span> EGS_Box::type(<span class="stringliteral">&quot;EGS_Box&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message1[] = <span class="stringliteral">&quot;createGeometry(box): %s\n&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message2[] = <span class="stringliteral">&quot;null input?&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message3[] = <span class="stringliteral">&quot;wrong/missing &#39;box size&#39; input?&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_message4[] =</div>
<div class="line">    <span class="stringliteral">&quot;expecting 1 or 3 float inputs for &#39;box size&#39;&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> EGS_BOX_LOCAL ebox_key1[] = <span class="stringliteral">&quot;box size&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div>
<div class="line"></div>
<div class="line">    EGS_BOX_EXPORT <a class="code" href="classEGS__BaseGeometry.html">EGS_BaseGeometry</a> *<a class="code" href="egs__glib_8cpp.html#af739645bb95fe92562fec40be47ee9e2">createGeometry</a>(<a class="code" href="classEGS__Input.html">EGS_Input</a> *input) {</div>
<div class="line">        <span class="keywordflow">if</span> (!input) {</div>
<div class="line">            <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb">egsWarning</a>(ebox_message1,ebox_message2);</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        vector&lt;EGS_Float&gt; s;</div>
<div class="line">        <span class="keywordtype">int</span> err = input-&gt;<a class="code" href="classEGS__Input.html#a154f3de14ebb23c3e78316b40b33b719">getInput</a>(ebox_key1,s);</div>
<div class="line">        <span class="keywordflow">if</span> (err) {</div>
<div class="line">            <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb">egsWarning</a>(ebox_message1,ebox_message3);</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="classEGS__AffineTransform.html">EGS_AffineTransform</a> *t = <a class="code" href="classEGS__AffineTransform.html#a601a07115aecff1925956a9097e69950">EGS_AffineTransform::getTransformation</a>(input);</div>
<div class="line">        <a class="code" href="classEGS__Box.html">EGS_Box</a> *result;</div>
<div class="line">        <span class="keywordflow">if</span> (s.size() == 1) {</div>
<div class="line">            result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html">EGS_Box</a>(s[0],t);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s.size() == 3) {</div>
<div class="line">            result = <span class="keyword">new</span> <a class="code" href="classEGS__Box.html">EGS_Box</a>(s[0],s[1],s[2],t);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code" href="group__egspp__main.html#gadf4109d942f372e48e1dea86c0ca62cb">egsWarning</a>(ebox_message1,ebox_message4);</div>
<div class="line">            <span class="keywordflow">if</span> (t) {</div>
<div class="line">                <span class="keyword">delete</span> t;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (t) {</div>
<div class="line">            <span class="keyword">delete</span> t;</div>
<div class="line">        }</div>
<div class="line">        result-&gt;<a class="code" href="classEGS__BaseGeometry.html#a77e25cd36d6d94f26338cca9bc98b97d">setName</a>(input);</div>
<div class="line">        result-&gt;<a class="code" href="classEGS__BaseGeometry.html#ae77c2c0762b6ab11b98dc9983b144299">setBoundaryTolerance</a>(input);</div>
<div class="line">        result-&gt;<a class="code" href="classEGS__BaseGeometry.html#a28bf612777de14f97108021ae7eb3865">setMedia</a>(input);</div>
<div class="line">        result-&gt;<a class="code" href="classEGS__BaseGeometry.html#abc5fa5c48edfbbd913e1939299fe5286">setLabels</a>(input);</div>
<div class="line">        <span class="keywordflow">return</span> result;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
